{"version":3,"file":"markdown-it-github-headings.umd.js","sources":["../index.js"],"sourcesContent":["module.exports = plugin;\n\nlet GithubSlugger = require('github-slugger');\nlet innertext = require('innertext');\n\nlet defaultOptions = {\n  enableHeadingLinkIcons: true,\n  prefixHeadingIds: true,\n  prefix: 'user-content-',\n  className: 'anchor',\n  // shamelessly borrowed from GitHub, thanks y'all\n  linkIcon: '<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg>',\n  resetSlugger: true\n};\n\nfunction plugin(md, _opts) {\n  let options = Object.assign({}, defaultOptions, _opts);\n\n  if (!options.prefixHeadingIds) options.prefix = '';\n\n  let slugger = new GithubSlugger();\n  let Token;\n\n  md.core.ruler.push('headingLinks', function (state) {\n    if (options.resetSlugger) {\n      slugger.reset();\n    }\n\n    // save the Token constructor because we'll be building a few instances at render\n    // time; that's sort of outside the intended markdown-it parsing sequence, but\n    // since we have tight control over what we're creating (a link), we're safe\n    if (!Token) {\n      Token = state.Token;\n    }\n  });\n\n  md.renderer.rules.heading_open = function (tokens, idx, opts, env, self) {\n    let children = tokens[idx + 1].children;\n    // make sure heading is not empty\n    if (children && children.length) {\n      // Generate an ID based on the heading's innerHTML; first, render without\n      // converting gemoji strings to unicode emoji characters\n      let unemojiWithToken = unemoji.bind(null, Token);\n      let rendered = md.renderer.renderInline(children.map(unemojiWithToken), opts, env);\n      let postfix = slugger.slug(\n        innertext(rendered)\n          .replace(/[<>]/g, '') // In case the heading contains `<stuff>`\n          .toLowerCase() // because `slug` doesn't lowercase\n      );\n\n      // add 3 new token objects link_open, text, link_close\n      let linkOpen = new Token('link_open', 'a', 1);\n      let text = new Token('html_inline', '', 0);\n      if (options.enableHeadingLinkIcons) {\n        text.content = options.linkIcon;\n      }\n      let linkClose = new Token('link_close', 'a', -1);\n\n      // add some link attributes\n      linkOpen.attrSet('id', options.prefix + postfix);\n      linkOpen.attrSet('class', options.className);\n      linkOpen.attrSet('href', '#' + postfix);\n      linkOpen.attrSet('aria-hidden', 'true');\n\n      // add new token objects as children of heading\n      children.unshift(linkClose);\n      children.unshift(text);\n      children.unshift(linkOpen);\n    }\n\n    return md.renderer.renderToken(tokens, idx, options, env, self);\n  };\n}\n\nfunction unemoji(TokenConstructor, token) {\n  if (token.type === 'emoji') {\n    return Object.assign(new TokenConstructor(), token, { content: token.markup });\n  }\n  return token;\n}\n"],"names":["module","exports","plugin","GithubSlugger","require","innertext","defaultOptions","enableHeadingLinkIcons","prefixHeadingIds","prefix","className","linkIcon","resetSlugger","md","_opts","options","Object","assign","slugger","Token","core","ruler","push","state","reset","renderer","rules","heading_open","tokens","idx","opts","env","self","children","length","unemojiWithToken","unemoji","bind","rendered","renderInline","map","postfix","slug","replace","toLowerCase","linkOpen","text","content","linkClose","attrSet","unshift","renderToken","TokenConstructor","token","type","markup"],"mappings":"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"}