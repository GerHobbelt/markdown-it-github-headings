{"version":3,"file":"markdown-it-github-headings.js","sources":["../index.js"],"sourcesContent":["module.exports = plugin;\n\nlet GithubSlugger = require('github-slugger');\nlet innertext = require('innertext');\n\nlet defaultOptions = {\n  enableHeadingLinkIcons: true,\n  prefixHeadingIds: true,\n  prefix: 'user-content-',\n  className: 'anchor',\n  // shamelessly borrowed from GitHub, thanks y'all\n  linkIcon: '<svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>',\n  resetSlugger: true\n};\n\nfunction plugin(md, _opts) {\n  let options = Object.assign({}, defaultOptions, _opts);\n\n  if (!options.prefixHeadingIds) options.prefix = '';\n\n  let slugger = new GithubSlugger();\n  let Token;\n\n  md.core.ruler.push('headingLinks', function (state) {\n    if (options.resetSlugger) {\n      slugger.reset();\n    }\n\n    // save the Token constructor because we'll be building a few instances at render\n    // time; that's sort of outside the intended markdown-it parsing sequence, but\n    // since we have tight control over what we're creating (a link), we're safe\n    if (!Token) {\n      Token = state.Token;\n    }\n  });\n\n  md.renderer.rules.heading_open = function (tokens, idx, opts, env, self) {\n    let children = tokens[idx + 1].children;\n    // make sure heading is not empty\n    if (children && children.length) {\n      // Generate an ID based on the heading's innerHTML; first, render without\n      // converting gemoji strings to unicode emoji characters\n      let unemojiWithToken = unemoji.bind(null, Token);\n      let rendered = md.renderer.renderInline(children.map(unemojiWithToken), opts, env);\n      let postfix = slugger.slug(\n        innertext(rendered)\n          .replace(/[<>]/g, '') // In case the heading contains `<stuff>`\n          .toLowerCase() // because `slug` doesn't lowercase\n      );\n\n      // add 3 new token objects link_open, text, link_close\n      let linkOpen = new Token('link_open', 'a', 1);\n      let text = new Token('html_inline', '', 0);\n      if (options.enableHeadingLinkIcons) {\n        text.content = options.linkIcon;\n      }\n      let linkClose = new Token('link_close', 'a', -1);\n\n      // add some link attributes\n      linkOpen.attrSet('id', options.prefix + postfix);\n      linkOpen.attrSet('class', options.className);\n      linkOpen.attrSet('href', '#' + postfix);\n      linkOpen.attrSet('aria-hidden', 'true');\n\n      // add new token objects as children of heading\n      children.unshift(linkClose);\n      children.unshift(text);\n      children.unshift(linkOpen);\n    }\n\n    return md.renderer.renderToken(tokens, idx, options, env, self);\n  };\n}\n\nfunction unemoji(TokenConstructor, token) {\n  if (token.type === 'emoji') {\n    return Object.assign(new TokenConstructor(), token, { content: token.markup });\n  }\n  return token;\n}\n"],"names":["module","exports","plugin","GithubSlugger","require","innertext","defaultOptions","enableHeadingLinkIcons","prefixHeadingIds","prefix","className","linkIcon","resetSlugger","md","_opts","options","Object","assign","slugger","Token","core","ruler","push","state","reset","renderer","rules","heading_open","tokens","idx","opts","env","self","children","length","unemojiWithToken","unemoji","bind","rendered","renderInline","map","postfix","slug","replace","toLowerCase","linkOpen","text","content","linkClose","attrSet","unshift","renderToken","TokenConstructor","token","type","markup"],"mappings":"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"}